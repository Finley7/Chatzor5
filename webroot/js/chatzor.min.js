function load_chats(){var a=$.getJSON("/ajax/chats/index");a.success(function(a){$.each(a,function(a,e){$.each(e,function(a,e){var s=new Date(e.created),t='<li data-id="'+e.id+'" class="list-group-item">\n';t+='<span class="text-muted pull-right">'+s.toLocaleString()+"</span>\n",t+='<span class="role '+e.user.primary_role.name+'">'+e.user.username+"</span> &raquo; "+e.message+"\n",t+="</li>",$(".chats").append(t)})})})}function lastshout(){var a=$.getJSON("/ajax/chats/lastid");a.success(function(a){var e=$(".chats").find(">:first-child");e.data("id")<a.chat.id&&load_chat(a.chat.id)}),$("time").timeago()}function load_chat(a){var e=$.getJSON("/ajax/chats/view/"+a);e.success(function(a){var e=new Date(a.chat.created),s='<li data-id="'+a.chat.id+'" class="list-group-item">\n';s+='<span class="text-muted pull-right">'+e.toLocaleString()+"</span>\n",s+='<span class="role '+a.chat.user.primary_role.name+'">'+a.chat.user.username+"</span> &raquo; "+a.chat.message+"\n",s+="</li>",$(".chats").prepend(s)})}$(function(){load_chats(),setInterval(lastshout,2e3),$("#messageform").submit(function(a){if(a.preventDefault(),""==$("#message").val())alert("Deze shout is te kort!");else{var e=$.ajax({url:$("#messageform").attr("action"),data:$("#messageform").serialize(),type:"POST",dataType:"JSON"});$("#message").val(""),e.success(function(a){"ok"==a.response.status?load_chat(a.response.id):alert(a.response.message)})}})});